<div class="flex flex-column h-full">

  <div class="flex justify-content-between align-items-center mb-3 px-2">
    <div>
      <h2 class="m-0 text-800">Malha Logística Urbana</h2>
      <p class="text-500 m-0 text-sm mt-1">Visualização da topologia da cidade e conexões ativas.</p>
    </div>
    <p-button icon="pi pi-refresh" label="Recarregar" styleClass="p-button-outlined p-button-secondary"
      (click)="carregarDadosIniciais()"></p-button>
  </div>

  <div class="relative flex-grow-1 border-1 surface-border border-round shadow-1 bg-white overflow-hidden">

    @if (isLoading) {
    <div class="absolute w-full h-full flex align-items-center justify-content-center bg-white z-5">
      <p-progressSpinner ariaLabel="Carregando mapa..."></p-progressSpinner>
    </div>
    }

    <div #networkContainer class="w-full h-full"></div>

    <div class="absolute bottom-0 left-0 m-3 p-3 surface-overlay shadow-2 border-round opacity-90 hidden md:block">
      <div class="flex align-items-center gap-2 mb-2">
        <span class="w-1rem h-1rem border-circle bg-green-500 block"></span>
        <span class="text-sm">Bairro Ativo</span>
      </div>

      <div class="flex align-items-center gap-2">
        <span class="w-1rem h-1rem border-circle bg-red-500 block"></span>
        <span class="text-sm">Bairro Inativo</span>
      </div>
    </div>
  </div>

</div>

<p-sidebar [(visible)]="sidebarVisible" position="right" [style]="{width: '400px'}" styleClass="p-sidebar-md">
  @if (bairroSelecionado) {
  <div class="flex flex-column gap-3">

    <div class="border-bottom-1 surface-border pb-3">
      <span class="text-500 text-sm uppercase font-bold">Bairro Selecionado</span>
      <h2 class="text-green-700 m-0 mt-1">{{ bairroSelecionado.nome }}</h2>
      <p class="text-600 mt-2 text-sm">{{ bairroSelecionado.descricao || 'Sem descrição cadastrada.' }}</p>
    </div>

    <div>
      <h3 class="text-700 text-lg mb-3 flex align-items-center gap-2">
        <i class="pi pi-map-marker text-orange-500"></i> Pontos de Coleta
      </h3>

      @if (isLoadingPontos) {
      <div class="flex justify-content-center p-4">
        <i class="pi pi-spin pi-spinner text-2xl text-green-500"></i>
      </div>
      } @else {
      @if (pontosDoBairro.length > 0) {
      <div class="flex flex-column gap-3">
        @for (ponto of pontosDoBairro; track ponto.id) {
        <p-card styleClass="surface-50 border-1 surface-border shadow-none">
          <div class="font-bold text-800 mb-1">{{ ponto.nomePonto }}</div>
          <div class="text-sm text-600 mb-2"><i class="pi pi-building text-xs mr-1"></i> {{ ponto.endereco }}</div>
          <div class="flex gap-1 flex-wrap">
            @for (tipo of ponto.tiposResiduosAceitos; track tipo.id) {
            <p-tag [value]="tipo.nome" severity="warning" styleClass="text-xs"></p-tag>
            }
          </div>
        </p-card>
        }
      </div>
      } @else {
      <div class="text-center p-4 border-1 border-dashed surface-border border-round text-500 bg-gray-50">
        <i class="pi pi-info-circle text-2xl mb-2 block"></i>
        Nenhum ponto de coleta neste bairro.
      </div>
      }
      }
    </div>
  </div>
  }
</p-sidebar>